<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head>
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-LX7DVC3P8K"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-LX7DVC3P8K');
    </script>

    










    







<script defer language="javascript" type="text/javascript" src="/js/bundle.min.a43a549406127e0715f68083c987d71d0c71054cd57edea77aa709ed9958af6e.js"></script>






    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">

    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    
    <link rel="icon" href=/favicon.png>

    
    





  





  
  
  


<!-- Open Graph image and Twitter Card metadata -->

<title itemprop="name">Ron Bulaon - PfSense - OpenVPN</title>
<meta property="og:title" content=Ron&#32;Bulaon&#32;-&#32;PfSense&#32;-&#32;OpenVPN />
<meta name="twitter:title" content=Ron&#32;Bulaon&#32;-&#32;PfSense&#32;-&#32;OpenVPN />
<meta itemprop="name" content=Ron&#32;Bulaon&#32;-&#32;PfSense&#32;-&#32;OpenVPN />
<meta name="application-name" content=Ron&#32;Bulaon&#32;-&#32;PfSense&#32;-&#32;OpenVPN />
<meta property="og:site_name" content="" />


<meta name="description" content="" />
<meta itemprop="description" content="" />
<meta property="og:description" content="" />
<meta name="twitter:description" content="" />


<base href="https://ronbulaon.github.io/posts/pfsenseovpn1/" />
<link rel="canonical" href="https://ronbulaon.github.io/posts/pfsenseovpn1/" itemprop="url" />
<meta name="url" content="https://ronbulaon.github.io/posts/pfsenseovpn1/" />
<meta name="twitter:url" content="https://ronbulaon.github.io/posts/pfsenseovpn1/" />
<meta property="og:url" content="https://ronbulaon.github.io/posts/pfsenseovpn1/" />


<meta property="og:updated_time" content="2024-04-22T21:28:18Z" />


<link rel="sitemap" type="application/xml" title="Sitemap" href='https://ronbulaon.github.io/sitemap.xml' />

<meta name="robots" content="index,follow" />
<meta name="googlebot" content="index,follow" />


<meta name="twitter:site" content="" />
<meta name="twitter:creator" content="" />
<meta property="fb:admins" content="" />


<meta name="apple-mobile-web-app-title" content="" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black" />






<meta name="generator" content="Hugo 0.121.2">


    
    

<link type="text/css" rel="stylesheet" href="/css/bundle.min.94a339836f89f0d25f31980cb6b0631da21e20af128308747ce44e0525eb16ef.css">


    
    <style>
    body {
        --sidebar-bg-color: #202020;
        --sidebar-img-border-color: #515151;
        --sidebar-p-color: #909090;
        --sidebar-h1-color: #FFF;
        --sidebar-a-color: #FFF;
        --sidebar-socials-color: #FFF;
        --text-color: #222;
        --bkg-color: #FAF9F6;
        --post-title-color: #303030;
        --list-color: #5A5A5A;
        --link-color: #268BD2;
        --date-color: #515151;
        --table-border-color: #E5E5E5;
        --table-stripe-color: #F9F9F9;
        --code-color: #000;
        --code-background-color: #E5E5E5;
        --code-block-color: #FFF;
        --code-block-background-color: #272822;
        --moon-sun-color: #FFF;
        --moon-sun-background-color: #515151;
    }
    body.dark-theme {
        --text-color: #EEE;
        --bkg-color: #121212;
        --post-title-color: #DBE2E9;
        --list-color: #9D9D9D;
        --link-color: #268BD2;
        --date-color: #9A9A9A;
        --table-border-color: #515151;
        --table-stripe-color: #202020;
        --code-color: #FFF;
        --code-background-color: #515151;
        --code-block-color: #FFF;
        --code-block-background-color: #272822;
    }
    body {
        background-color: var(--bkg-color);
    }
</style>

</head>

    <body class="">
        <div class="wrapper">
            <aside class="sidebar">
    <div class="container sidebar-sticky">
        <div class="light-dark" align="right">
    <button class="btn-light-dark" title="Toggle light/dark mode">
        <svg class="moon" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16">
            <path fill="currentColor" d="M6 .278a.768.768 0 0 1 .08.858a7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277c.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316a.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71C0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"/>
        </svg>
        <svg class="sun" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" viewBox="0 0 16 16">
            <path fill="currentColor" d="M8 12a4 4 0 1 0 0-8a4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"/>
        </svg>
    </button>
</div>

        <div class="sidebar-about">
    <h1 class="brand">
        
            <a href="https://ronbulaon.github.io/">
                <img src="/images/profilepix.jpg" alt="brand image">
            </a>
        
        
            <a href="https://ronbulaon.github.io/">
                <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
                <h1 style="font-family: 'Roboto', sans-serif;">Ron Bulaon</h1>
            </a>
        
    </h1>
    <p class="lead">
    Build - Secure - Inovate
    </p>
</div>

        <center>
<nav>
    <ul class="sidebar-nav">
        
        
        
        
            

            
                
                
            
                
                
                    <li class="heading">
                        <a href="/posts/">My Posts</a>
                    </li>
                    
                
            
            
                
                
            
                
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
            
        
        
            

            
                
                
                    <li class="heading">
                        <a href="/about/">About Me</a>
                    </li>
                    
                
            
                
                
            
            
                
                
            
                
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
                        
                
            
        

    </ul>
</nav>
</center>
        <div style="width: 90%; height: 25vh; background-color: transparent; border: none; margin: 0;"></div>
<center><footer>

    <a target="_blank" class="social" title="GitHub" href="https://github.com/RonBulaon">
        <svg xmlns="http://www.w3.org/2000/svg" width="1.2em" height="1.2em" viewBox="-2 -2 24 24">
            <path fill="currentColor" d="M18.88 1.099C18.147.366 17.265 0 16.233 0H3.746C2.714 0 1.832.366 1.099 1.099C.366 1.832 0 2.714 0 3.746v12.487c0 1.032.366 1.914 1.099 2.647c.733.733 1.615 1.099 2.647 1.099H6.66c.19 0 .333-.007.429-.02a.504.504 0 0 0 .286-.169c.095-.1.143-.245.143-.435l-.007-.885c-.004-.564-.006-1.01-.006-1.34l-.3.052c-.19.035-.43.05-.721.046a5.555 5.555 0 0 1-.904-.091a2.026 2.026 0 0 1-.872-.39a1.651 1.651 0 0 1-.572-.8l-.13-.3a3.25 3.25 0 0 0-.41-.663c-.186-.243-.375-.407-.566-.494l-.09-.065a.956.956 0 0 1-.17-.156a.723.723 0 0 1-.117-.182c-.026-.061-.004-.111.065-.15c.07-.04.195-.059.378-.059l.26.04c.173.034.388.138.643.311a2.1 2.1 0 0 1 .631.677c.2.355.44.626.722.813c.282.186.566.28.852.28c.286 0 .533-.022.742-.065a2.59 2.59 0 0 0 .585-.196c.078-.58.29-1.028.637-1.34a8.907 8.907 0 0 1-1.333-.234a5.314 5.314 0 0 1-1.223-.507a3.5 3.5 0 0 1-1.047-.872c-.277-.347-.505-.802-.683-1.365c-.177-.564-.266-1.215-.266-1.952c0-1.049.342-1.942 1.027-2.68c-.32-.788-.29-1.673.091-2.652c.252-.079.625-.02 1.119.175c.494.195.856.362 1.086.5c.23.14.414.257.553.352a9.233 9.233 0 0 1 2.497-.338c.859 0 1.691.113 2.498.338l.494-.312a6.997 6.997 0 0 1 1.197-.572c.46-.174.81-.221 1.054-.143c.39.98.424 1.864.103 2.653c.685.737 1.028 1.63 1.028 2.68c0 .737-.089 1.39-.267 1.957c-.177.568-.407 1.023-.689 1.366a3.65 3.65 0 0 1-1.053.865c-.42.234-.828.403-1.223.507a8.9 8.9 0 0 1-1.333.235c.45.39.676 1.005.676 1.846v3.11c0 .147.021.266.065.357a.36.36 0 0 0 .208.189c.096.034.18.056.254.064c.074.01.18.013.318.013h2.914c1.032 0 1.914-.366 2.647-1.099c.732-.732 1.099-1.615 1.099-2.647V3.746c0-1.032-.367-1.914-1.1-2.647z"/>
        </svg>
    </a>



    <a target="_blank" class="social" title="LinkedIn" href="https://www.linkedin.com/in/ronbulaon/">
        <svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1.2em" viewBox="0 0 448 512">
            <path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5c0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7c-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5c67.2 0 79.7 44.3 79.7 101.9V416z"/>
        </svg>
    </a>






    <a target="_blank" class="social" title="YouTube" href="https://www.youtube.com/c/RonBulaon">
        <svg xmlns="http://www.w3.org/2000/svg" width="1.2em" height="1.2em" viewBox="0 0 24 24">
            <path fill="currentColor" d="M12.006 19.012h-.02c-.062 0-6.265-.012-7.83-.437a2.5 2.5 0 0 1-1.764-1.765A26.494 26.494 0 0 1 1.986 12a26.646 26.646 0 0 1 .417-4.817A2.564 2.564 0 0 1 4.169 5.4c1.522-.4 7.554-.4 7.81-.4H12c.063 0 6.282.012 7.831.437c.859.233 1.53.904 1.762 1.763c.29 1.594.427 3.211.407 4.831a26.568 26.568 0 0 1-.418 4.811a2.51 2.51 0 0 1-1.767 1.763c-1.52.403-7.553.407-7.809.407Zm-2-10.007l-.005 6l5.212-3l-5.207-3Z"/>
        </svg>
    </a>









</footer>
</center>
        


<p class="footnote">
powered by <a target="_blank" href="https://gohugo.io">Hugo</a> | themed with <a target="_blank" href="https://github.com/lukeorth/poison">poison</a>
    <br>
    &copy; 2024 . All rights reserved.
</p>






  </div>
</aside>

            <main class="content container">
                <ul id="breadcrumbs" style="list-style: none; display: flex; flex-wrap: wrap; padding: 0; margin: 0;">
    <li>
        <a href="https://ronbulaon.github.io/" class="post-title"><h4>Home</h4></a> 
    </li>
        <li style="margin-right: 5px;">
            <a href="/" class="post-title"><h4>&nbsp;</a>&gt;</h4> 
        </li>
        <li style="margin-right: 5px;">
            <a href="/posts/" class="post-title"><h4>Posts&nbsp;</a>&gt;</h4> 
        </li>
    <li style="margin-right: 5px;">
        <h4><div style="color: gray;">PfSense - OpenVPN</div></h4>
    </li>
</ul>
<hr>
 
                <div class="post">
  <div class="info">
  <h1 class="post-title">
    <a href="https://ronbulaon.github.io/posts/pfsenseovpn1/">PfSense - OpenVPN</a>
  </h1>

  <div class="headline">
    <div>
      
      <time datetime=" 2024-04-22T21:28:18Z" class="post-date">
        April 22, 2024
      </time>
      
      <span> - </span>
      <span class="reading-time">
        
          
        

        <span>7 mins read</span>
      </span>
    </div>

    
    <ul class="tags">
      
      <li class="tag-networking">
        <a href="https://ronbulaon.github.io/tags/networking">networking</a>
      </li>
      
      <li class="tag-open vpn">
        <a href="https://ronbulaon.github.io/tags/open-vpn">open vpn</a>
      </li>
      
      <li class="tag-pfsense">
        <a href="https://ronbulaon.github.io/tags/pfsense">pfsense</a>
      </li>
      
      <li class="tag-system administration">
        <a href="https://ronbulaon.github.io/tags/system-administration">system administration</a>
      </li>
      
    </ul>
    
  </div>

  
  

  
</div>

  <h2 id="overview-and-objective">Overview and Objective</h2>
<p>This document outlines the process for setting up a site-to-site OpenVPN connection using pfSense. The goal is to establish a secure, encrypted tunnel between two separate networks over the internet, ensuring secure communication and data transfer between the connected networks.</p>
<p>The objective of this guide is to provide step-by-step instructions for configuring this site-to-site OpenVPN connection using SSL/TLS on pfSense. This setup aims to create a secure link between two remote networks, allowing for seamless and secure communication as if they were on the same local network.</p>
<h3 id="network-diagram">Network Diagram</h3>
<ul>
<li><strong>Site A</strong>: This site has a local area network (LAN) connected to a pfSense router. The pfSense router at Site A is configured as the OpenVPN server.</li>
<li><strong>Site B</strong>: This site also has a local area network (LAN) connected to a pfSense router. The pfSense router at Site B is configured as the OpenVPN client.</li>
</ul>
<p>The end result is that Site A and Site B will be securely connected as if they are on the same local network, allowing seamless communication between the two sites.</p>
<p><br/><img src="/images/pfsense/pfsensenetdiag.png" alt="screenshot" width="800"/>
<br/><br/></p>
<h3 id="why-pfsense">Why PFsense</h3>
<p>pfSense offers a user-friendly interface with an integrated OpenVPN, simplifying the setup process significantly. Its comprehensive documentation and strong community support further streamline implementation, making it a highly accessible and cost-effective solution for secure site-to-site VPN connections.
<br/></p>
<h2>Table of Contents</h2>
<!-- TOC -->
<ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#objective">Objective</a></li>
<li><a href="#certificates">Certificates</a>
<ul>
<li><a href="#create-a-certificate-authority-ca">Create a Certificate Authority CA</a></li>
<li><a href="#creating-server-and-user-certificates">Creating Server and User Certificates</a>
<ul>
<li><a href="#creating-server-certificates">Creating Server Certificates</a></li>
<li><a href="#creating-user-certificates">Creating User Certificates</a></li>
</ul>
</li>
<li><a href="#import-certificates-from-openvpn-server-to-the-client-server">Import certificates from OpenVPN Server to the Client Server.</a></li>
</ul>
</li>
<li><a href="#openvpn-server">OpenVPN Server</a>
<ul>
<li><a href="#configuring-pfsense-as-openvpn-server">Configuring PFsense as OpenVPN Server</a></li>
<li><a href="#interface-assignment-configuration">Interface Assignment Configuration</a></li>
<li><a href="#set-firewall-rules">Set Firewall Rules</a></li>
</ul>
</li>
<li><a href="#openvpn-client">OpenVPN Client</a>
<ul>
<li><a href="#configuring-pfsense-as-openvpn-client">Configuring PFSense as OpenVPN Client</a></li>
<li><a href="#interface-assignment-configuration">Interface Assignment Configuration</a></li>
<li><a href="#set-firewall-rules">Set Firewall Rules</a></li>
<li><a href="#static-routes-configuration">Static Routes Configuration</a></li>
</ul>
</li>
</ul>
<!-- - [Testing](#testing) -->
<ul>
<li><a href="#summary">Summary</a></li>
</ul>
<!-- /TOC -->
<!-- /TOC -->
<h2 id="certificates">Certificates</h2>
<h3 id="create-a-certificate-authority-ca">Create a Certificate Authority (CA)</h3>
<ol>
<li>From the top menu click <strong>System</strong> &gt; <strong>Certificates</strong> <br/><img src="/images/pfsense/pfsense0001.png" alt="screenshot" width="200"/></li>
<li>Make sure you are at <strong>Authorities</strong> tab then click <strong>Add</strong> <br/><img src="/images/pfsense/pfsense0002.png" alt="screenshot" width="700"/></li>
<li>Fill up the requirted information:
<ul>
<li>
<p>Descriptive name : <strong>ronworks.com</strong> you can put anything as description</p>
</li>
<li>
<p>Under <strong>Internal Certificate AUthority</strong>, the default will work but it is ideal to put in your information to avoid confusion id having multiple CAs.</p>
</li>
<li>
<p>then click <strong>Save</strong>.
<br/><img src="/images/pfsense/pfsense0003.png" alt="screenshot" width="700"/></p>
</li>
</ul>
</li>
<li>Verify that the CA is created then click <strong>Certificates</strong> tab. <br/><img src="/images/pfsense/pfsense0004.png" alt="screenshot" width="700"/></li>
</ol>
<h3 id="creating-server-and-user-certificates">Creating Server and User Certificates</h3>
<h4 id="creating-server-certificates">Creating Server Certificates</h4>
<ol>
<li>From the <strong>Certificates</strong> tab, click <strong>Add/Sign</strong>. <br/><img src="/images/pfsense/pfsense0005.png" alt="screenshot" width="700"/></li>
<li>At the <strong>Add/Sign a New Certificate</strong> section, make sure that:
<ul>
<li>Method : Create Internal Certificate</li>
<li>Descriptive name can be anything helpful for you to describe its purpose. <br/><img src="/images/pfsense/pfsense0006.png" alt="screenshot" width="700"/></li>
</ul>
</li>
<li>At the <strong>Internal Certificate</strong> section, make sure that:
<ul>
<li><strong>Certificate Authority</strong> us same as the <a href="#create-a-certificate-authority-ca">Certificate Authority (CA)</a> created earlier.</li>
<li>For <strong>Common Name</strong> the combination of the descriptive name and the CA can be used. <br/><img src="/images/pfsense/pfsense0007.png" alt="screenshot" width="700"/></li>
</ul>
</li>
<li>At the <strong>Certificate Attributes</strong> section, make sure that the <strong>Certificate type</strong> is <strong>Server Certificate</strong>. Then click <strong>Save</strong>.<br/><img src="/images/pfsense/pfsense0008.png" alt="screenshot" width="700"/></li>
</ol>
<h4 id="creating-user-certificates">Creating User Certificates</h4>
<ol>
<li>Follow steps in <a href="#creating-server-certificates">creating server certificates</a>. Take note of the following changes. <br/><img src="/images/pfsense/pfsense0010.png" alt="screenshot" width="700"/></li>
<li>At the <strong>Certificate Attributes</strong> section, choose <strong>User Certificate</strong> in <strong>Certificate type</strong> then click <strong>Save</strong>.<br/><img src="/images/pfsense/pfsense0009.png" alt="screenshot" width="700"/></li>
<li>Verify that the certificates are created according to the specification inputed. <br/><img src="/images/pfsense/pfsense0011.png" alt="screenshot" width="700"/></li>
</ol>
<h3 id="import-certificates-from-openvpn-server-to-the-client-server">Import certificates from OpenVPN Server to the Client Server.</h3>
<ol>
<li>On both server and client open pfsense.</li>
<li>Go to <strong>System</strong> &gt; <strong>Certificates</strong> then click authorities.
<br/><img src="/images/pfsense/pfsense0001.png" alt="screenshot" width="200"/></li>
<li>On the server side click edit on the Certificate authority (CA) to be imported and Add on the client.
<br/><img src="/images/pfsense/pfsense011.png" alt="screenshot" width="100%"/></li>
<li>On the client&rsquo;s Method choose Import an existing Certificate Authority fromt he dropdown. Then copy all field values from the server to the client. Then click Save.
<br/><img src="/images/pfsense/pfsense012.png" alt="screenshot" width="100%"/></li>
<li>Then on both server click, click <strong>Certificates</strong> tab. <br/> On the server click <strong>edit</strong> for the <strong>User Certificate</strong>  then <strong>Add/Sign</strong> on the <strong>client</strong>.
<br/><img src="/images/pfsense/pfsense013.png" alt="screenshot" width="100%"/></li>
<li>On the client&rsquo;s method choose <strong>Import an existing Certificate</strong> then copy the same values from the server side. Then click <strong>Save</strong>.
<br/><img src="/images/pfsense/pfsense014.png" alt="screenshot" width="100%"/></li>
</ol>
<h2 id="openvpn-server">OpenVPN Server</h2>
<h3 id="configuring-pfsense-as-openvpn-server">Configuring PFsense as OpenVPN Server</h3>
<ol>
<li>VPN &gt; <strong>OpenVPN</strong>
<br/><img src="/images/pfsense/pfsense001.png" alt="screenshot" width="200"/></li>
<li>Click <strong>Servers</strong> tab then click <strong>Add</strong>
<br/><img src="/images/pfsense/pfsense002.png" alt="screenshot" width="700"/></li>
<li>At the <strong>General Information</strong>, indicate a description to this vpn server.
<br/><img src="/images/pfsense/pfsense004.png" alt="screenshot" width="700"/></li>
<li>At <strong>Mode of Configuration</strong> choose:
<ul>
<li>Server mode : <strong>Peer to Peer ( SSL/TLS )</strong></li>
<li>Device Mode : <strong>tun - Layer e Tunnel Mode</strong>
<br/><img src="/images/pfsense/pfsense005.png" alt="screenshot" width="700"/></li>
</ul>
</li>
<li>At <strong>Endpoint Configuration</strong>, use the following settings:
<ul>
<li>Protocol : <strong>UDP on IPv4 only</strong></li>
<li>Interface : <strong>WAN</strong></li>
<li>Local port : <strong>1194</strong>
<br/><img src="/images/pfsense/pfsense006.png" alt="screenshot" width="700"/></li>
</ul>
</li>
<li>At the <strong>Cryptographic Settings</strong>:
<ul>
<li><strong>Use a TLS Key</strong> : Make sure its <em>unchecked</em></li>
<li><strong>Peer Certificate Authority</strong> : Make sure its the same CA created in certificates section.</li>
<li><strong>Server certificate</strong> : Choose the server certificate created for this server.
<br/><img src="/images/pfsense/pfsense007.png" alt="screenshot" width="700"/></li>
<li><strong>Enforce key usage</strong> : Make sure its <em>checked</em>
<br/><img src="/images/pfsense/pfsense035.png" alt="screenshot" width="700"/></li>
</ul>
</li>
<li>At the <strong>Tunnel Settings</strong>:
<ul>
<li>IPv4 Tunnel : <code>10.8.0.0/24</code> - Assign a network that will be used by the tunnel. Use a network address not used anywhere in your network.</li>
<li>IPv4 Local network(s) : <code>192.168.100.0/24</code> - Put in here the local LAN network you want to be accessible through VPN</li>
<li>IPv4 Remote network(s) : <code>192.168.200.0/24</code> - The target network intended to be routed in this tunnel.
<br/><img src="/images/pfsense/pfsense008.png" alt="screenshot" width="700"/></li>
</ul>
</li>
<li>Scroll down to <strong>Advanced Configuration</strong>, at <strong>Gateway creation</strong> choose <code>IPv4 only</code> then click <strong>Save</strong>.
<br/><img src="/images/pfsense/pfsense009.png" alt="screenshot" width="700"/></li>
<li>Go to <strong>Client Specific Override</strong> tab, then click <strong>Add</strong>.
<br/><img src="/images/pfsense/pfsense039.png" alt="screenshot" width="700"/></li>
<li>Be guided that :
<ul>
<li>Description : Put a name to describe this setting.</li>
<li>Common name : THis is the CN entry on the user certificate.</li>
<li>Server List : Choose the VPN server created earlier.
<br/><img src="/images/pfsense/pfsense040.png" alt="screenshot" width="700"/></li>
</ul>
</li>
<li>For <strong>IPv4 Remote Network/s</strong>, fill this up with the remote LAN&rsquo;s network address.
<br/><img src="/images/pfsense/pfsense041.png" alt="screenshot" width="700"/></li>
<li>Click <strong>Save</strong>.</li>
</ol>
<h3 id="interface-assignment-configuration">Interface Assignment Configuration</h3>
<ol>
<li>From the top level menu click Interfaces &gt; Assignments.
<br/><img src="/images/pfsense/pfsense025.png" alt="screenshot" width="200"/></li>
<li>Verify that there&rsquo;s an interface named that corresponds to vpn server then click <strong>Add</strong>.
<br/><img src="/images/pfsense/pfsense026.png" alt="screenshot" width="700"/></li>
<li>Once Added, click the name of the added interface.
<br/><img src="/images/pfsense/pfsense027.png" alt="screenshot" width="700"/></li>
<li>Check the <em><strong>Enable interface</strong></em> box. And put appropriate name. Then click <strong>Save</strong>.
<br/><img src="/images/pfsense/pfsense028.png" alt="screenshot" width="700"/></li>
<li>CLick <em><strong>Apply Changes</strong></em> for the settings to take effect.
<br/><img src="/images/pfsense/pfsense029.png" alt="screenshot" width="700"/></li>
</ol>
<h3 id="set-firewall-rules">Set Firewall Rules</h3>
<ol>
<li>From the top level menu click <strong>Firewall</strong> &gt; <strong>Rules</strong>.
<br/><img src="/images/pfsense/pfsense032.png" alt="screenshot" width="150"/></li>
<li>Go to <em><strong>OpenVPN_interface</strong></em> tab (this is the same just added in the steps above). Then click <strong>Add</strong>.
<br/><img src="/images/pfsense/pfsense033.png" alt="screenshot" width="700"/></li>
<li>THen follow these settings:
<ul>
<li>Action : Pass</li>
<li>Interface : OPENVPN_INTERFACE</li>
<li>Address Family : IPv4+IPv6</li>
<li>Protocol : Any</li>
<li>Source : Any</li>
<li>Destination : Any
<br/><img src="/images/pfsense/pfsense034.png" alt="screenshot" width="700"/></li>
</ul>
</li>
<li>Click Save.</li>
<li>Click <strong>Apply Changes</strong> for the changes to take effect.
<br/><img src="/images/pfsense/pfsense024.png" alt="screenshot" width="700"/></li>
</ol>
<h2 id="openvpn-client">OpenVPN Client</h2>
<h3 id="configuring-pfsense-as-openvpn-client">Configuring PFSense as OpenVPN Client</h3>
<p>Do the following on the pfsese on the remote network</p>
<ol>
<li>VPN &gt; <strong>OpenVPN</strong>
<br/><img src="/images/pfsense/pfsense001.png" alt="screenshot" width="200"/></li>
<li>Click <strong>Clients</strong> tab then click <strong>Add</strong>
<br/><img src="/images/pfsense/pfsense010.png" alt="screenshot" width="700"/></li>
<li>At the <strong>General Information</strong> put in a description to idenfy this client.
<br/><img src="/images/pfsense/pfsense015.png" alt="screenshot" width="700"/></li>
<li>For Endpoint Configuration choose the following:
<ul>
<li>Protocol : <code>UDP on IPv4 only</code></li>
<li>Interface : <code>WAN</code></li>
<li>Server host or address : <code>200.168.100.2</code> - This should be same IP of the server&rsquo;s WAN address of the VPN server. This IP should be reachable (ping) from the client.</li>
<li>Server port : <code>1194</code> - Same port used by the VPN server
<br/><img src="/images/pfsense/pfsense016.png" alt="screenshot" width="700"/></li>
</ul>
</li>
<li>At the <strong>Cryptographic Settings</strong>:
<ul>
<li><strong>Use a TLS Key</strong> : unchecked</li>
<li><strong>Peer Certificate Authority</strong> : Use the certificated imported CA</li>
<li><strong>Client certificate</strong> : Use the certificated imported user certificate
<br/><img src="/images/pfsense/pfsense017.png" alt="screenshot" width="900"/></li>
</ul>
</li>
<li>Scroll down to <em><strong>Gateway creation</strong></em> and choose <em><strong>IPv4 only</strong></em>. Then click <strong>Save</strong>.
<br/><img src="/images/pfsense/pfsense019.png" alt="screenshot" width="700"/></li>
</ol>
<h3 id="interface-assignment-configuration-1">Interface Assignment Configuration</h3>
<ol>
<li>From the top level menu click Interfaces &gt; Assignments.
<br/><img src="/images/pfsense/pfsense025.png" alt="screenshot" width="200"/></li>
<li>Verify that there&rsquo;s an interface named that corresponds to vpn server then click <strong>Add</strong>.
<br/><img src="/images/pfsense/pfsense030.png" alt="screenshot" width="700"/></li>
<li>Once Added, click the name of the added interface.
<br/><img src="/images/pfsense/pfsense031.png" alt="screenshot" width="700"/></li>
<li>Check the <em><strong>Enable interface</strong></em> box. And put appropriate name. Then click <strong>Save</strong>.
<br/><img src="/images/pfsense/pfsense028.png" alt="screenshot" width="700"/></li>
<li>CLick <em><strong>Apply Changes</strong></em> for the settings to take effect.
<br/><img src="/images/pfsense/pfsense029.png" alt="screenshot" width="700"/></li>
</ol>
<h3 id="set-firewall-rules-1">Set Firewall Rules</h3>
<ol>
<li>From the top level menu click <strong>Firewall</strong> &gt; <strong>Rules</strong>.
<br/><img src="/images/pfsense/pfsense032.png" alt="screenshot" width="150"/></li>
<li>Go to <em><strong>OpenVPN_interface</strong></em> tab (this is the same just added in the steps above). Then click <strong>Add</strong>.
<br/><img src="/images/pfsense/pfsense033.png" alt="screenshot" width="700"/></li>
<li>Then follow these settings:
<ul>
<li>Action : Pass</li>
<li>Interface : OPENVPN_INTERFACE</li>
<li>Address Family : IPv4+IPv6</li>
<li>Protocol : Any</li>
<li>Source : Any</li>
<li>Destination : Any
<br/><img src="/images/pfsense/pfsense034.png" alt="screenshot" width="700"/></li>
</ul>
</li>
<li>Click Save.</li>
<li>Click <strong>Apply Changes</strong> for the changes to take effect.
<br/><img src="/images/pfsense/pfsense024.png" alt="screenshot" width="700"/></li>
</ol>
<h3 id="static-routes-configuration">Static Routes Configuration</h3>
<ol>
<li>From the top menu click <strong>System</strong> &gt; <strong>Routing</strong>
<br/><img src="/images/pfsense/pfsense036.png" alt="screenshot" width="150"/></li>
<li>Click <strong>Static Routes</strong> tab, then click <strong>Add</strong>.
<br/><img src="/images/pfsense/pfsense037.png" alt="screenshot" width="700"/></li>
<li>At the route entry create a route going to the remote network through OpenVPN interface. Then cLick <strong>Save</strong>.
<br/><img src="/images/pfsense/pfsense038.png" alt="screenshot" width="700"/></li>
</ol>
<h2 id="summary">Summary</h2>
<p>This guide detailed the necessary steps to configure a site-to-site OpenVPN connection using PfSense. Key steps included creating certificate authorities, server and user certificates, configuring the OpenVPN server and client settings, and setting up the necessary firewall rules and interface assignments. This guide ensures that users can establish a secure and reliable VPN tunnel between two sites, facilitating secure data exchange.</p>

  
  <hr>
<div class="footer">
    
	    
            <a class="previous-post" href="https://ronbulaon.github.io/posts/matrix2/?ref=footer"><span style="font-weight:bold;">« Previous</span><br>MATRIX-BREAKOUT 2</a>
        
	    
    
</div>

  
</div>
            </main>
            
  
    <div class="article-toc ">
    <div class="toc-wrapper">
      <h4 id="contents"></h4>
      <nav id="TableOfContents">
  <ul>
    <li><a href="#overview-and-objective">Overview and Objective</a>
      <ul>
        <li><a href="#network-diagram">Network Diagram</a></li>
        <li><a href="#why-pfsense">Why PFsense</a></li>
      </ul>
    </li>
    <li><a href="#certificates">Certificates</a>
      <ul>
        <li><a href="#create-a-certificate-authority-ca">Create a Certificate Authority (CA)</a></li>
        <li><a href="#creating-server-and-user-certificates">Creating Server and User Certificates</a></li>
        <li><a href="#import-certificates-from-openvpn-server-to-the-client-server">Import certificates from OpenVPN Server to the Client Server.</a></li>
      </ul>
    </li>
    <li><a href="#openvpn-server">OpenVPN Server</a>
      <ul>
        <li><a href="#configuring-pfsense-as-openvpn-server">Configuring PFsense as OpenVPN Server</a></li>
        <li><a href="#interface-assignment-configuration">Interface Assignment Configuration</a></li>
        <li><a href="#set-firewall-rules">Set Firewall Rules</a></li>
      </ul>
    </li>
    <li><a href="#openvpn-client">OpenVPN Client</a>
      <ul>
        <li><a href="#configuring-pfsense-as-openvpn-client">Configuring PFSense as OpenVPN Client</a></li>
        <li><a href="#interface-assignment-configuration-1">Interface Assignment Configuration</a></li>
        <li><a href="#set-firewall-rules-1">Set Firewall Rules</a></li>
        <li><a href="#static-routes-configuration">Static Routes Configuration</a></li>
      </ul>
    </li>
    <li><a href="#summary">Summary</a></li>
  </ul>
</nav>
    </div>
</div>

  

        </div>
    </body>
</html>
